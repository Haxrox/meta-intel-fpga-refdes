From 37615e0a57f4d48c6eeced4eea1f90946a8736a1 Mon Sep 17 00:00:00 2001
From: Matthew Gerlach <matthew.gerlach@linux.intel.com>
Date: Thu, 4 Nov 2021 14:13:39 -0700
Subject: [PATCH 3/5] HSD #14015468338-2: n6000: enable VAB

Add configuration for n6000 to support Vendor Authenticated
Boot.

Signed-off-by: Matthew Gerlach <matthew.gerlach@linux.intel.com>
Acked-by: Rodrigo Rojo <rodrigo.rojo@intel.com>
Acked-by: Tien Fong Chee <tien.fong.chee@intel.com>
---
 arch/arm/dts/socfpga_agilex_n6000-u-boot.dtsi | 17 ++++
 configs/socfpga_agilex_n6000_vab_defconfig    | 83 +++++++++++++++++++
 2 files changed, 100 insertions(+)
 create mode 100644 configs/socfpga_agilex_n6000_vab_defconfig

diff --git a/arch/arm/dts/socfpga_agilex_n6000-u-boot.dtsi b/arch/arm/dts/socfpga_agilex_n6000-u-boot.dtsi
index 16f5935053..7dcdffcdaa 100644
--- a/arch/arm/dts/socfpga_agilex_n6000-u-boot.dtsi
+++ b/arch/arm/dts/socfpga_agilex_n6000-u-boot.dtsi
@@ -103,3 +103,20 @@
 
 	/delete-node/ kernel;
 };
+
+#if defined(CONFIG_SOCFPGA_SECURE_VAB_AUTH)
+
+&kernel_uboot_blob {
+	filename = "signed-Image";
+};
+
+&kernel_uboot_fdt_blob {
+	filename = "signed-linux.dtb";
+};
+
+&kernel_ramdisk_blob {
+	filename = "signed-rootfs.cpio";
+};
+
+#endif
+
diff --git a/configs/socfpga_agilex_n6000_vab_defconfig b/configs/socfpga_agilex_n6000_vab_defconfig
new file mode 100644
index 0000000000..22ca6c46fd
--- /dev/null
+++ b/configs/socfpga_agilex_n6000_vab_defconfig
@@ -0,0 +1,83 @@
+CONFIG_ARM=y
+CONFIG_ARM_SMCCC=y
+CONFIG_SPL_LDSCRIPT="arch/arm/mach-socfpga/u-boot-spl-soc64.lds"
+CONFIG_ARCH_SOCFPGA=y
+CONFIG_SYS_TEXT_BASE=0x200000
+CONFIG_SYS_MALLOC_F_LEN=0x2000
+CONFIG_NR_DRAM_BANKS=2
+CONFIG_ENV_SIZE=0x1000
+CONFIG_ENV_OFFSET=0x200
+CONFIG_SYS_SPI_U_BOOT_OFFS=0x02000000
+CONFIG_DM_GPIO=y
+CONFIG_SPL_TEXT_BASE=0xFFE00000
+CONFIG_TARGET_SOCFPGA_AGILEX_N6000=y
+CONFIG_IDENT_STRING="socfpga_agilex"
+CONFIG_SPL_FS_FAT=y
+CONFIG_DEFAULT_DEVICE_TREE="socfpga_agilex_n6000"
+CONFIG_FIT=y
+CONFIG_SPL_LOAD_FIT=y
+CONFIG_SPL_LOAD_FIT_ADDRESS=0x02000000
+# CONFIG_ARMV8_SEC_FIRMWARE_SUPPORT=y
+# CONFIG_ARMV8_PSCI=y
+# CONFIG_USE_SPL_FIT_GENERATOR is not set
+CONFIG_BOOTDELAY=3
+CONFIG_USE_BOOTARGS=y
+CONFIG_BOOTARGS="earlycon uio_pdrv_genirq.of_id=intel,hps-copy-engine"
+CONFIG_USE_BOOTCOMMAND=y
+CONFIG_BOOTCOMMAND="mw f9000158 1 ; bootm 0x02000000#linux_conf"
+CONFIG_SPL_CACHE=y
+CONFIG_SPL_SPI_LOAD=y
+CONFIG_SPL_ATF=y
+CONFIG_SOCFPGA_SECURE_VAB_AUTH=y
+CONFIG_SPL_ATF_NO_PLATFORM_PARAM=y
+CONFIG_SPL_BOARD_INIT=y
+CONFIG_SPL_RAM_SUPPORT=y
+CONFIG_SPL_RAM_DEVICE=y
+CONFIG_BOARD_LATE_INIT=y
+CONFIG_HUSH_PARSER=y
+CONFIG_SYS_PROMPT="SOCFPGA_AGILEX # "
+CONFIG_CMD_MEMTEST=y
+CONFIG_CMD_GPIO=y
+CONFIG_CMD_I2C=y
+# CONFIG_CMD_MMC=y
+CONFIG_CMD_SPI=y
+CONFIG_CMD_USB=y
+CONFIG_CMD_DHCP=y
+CONFIG_CMD_MII=y
+CONFIG_CMD_PING=y
+CONFIG_CMD_CACHE=y
+CONFIG_CMD_EXT4=y
+CONFIG_CMD_FAT=y
+CONFIG_CMD_FS_GENERIC=y
+# CONFIG_ENV_IS_IN_MMC=y
+CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_SPL_DM_SEQ_ALIAS=y
+CONFIG_SPL_ALTERA_SDRAM=y
+CONFIG_DWAPB_GPIO=y
+CONFIG_DM_I2C=y
+CONFIG_SYS_I2C_DW=y
+CONFIG_DM_MMC=y
+# CONFIG_MMC_DW=y
+CONFIG_MTD=y
+CONFIG_SF_DEFAULT_MODE=0x2003
+CONFIG_SPI_FLASH_SPANSION=y
+CONFIG_SPI_FLASH_STMICRO=y
+CONFIG_PHY_MICREL=y
+CONFIG_PHY_MICREL_KSZ90X1=y
+CONFIG_DM_ETH=y
+CONFIG_ETH_DESIGNWARE=y
+CONFIG_MII=y
+CONFIG_DM_RESET=y
+CONFIG_SPI=y
+CONFIG_DM_SPI=y
+CONFIG_DESIGNWARE_SPI=y
+CONFIG_CADENCE_QSPI=y
+CONFIG_USB=y
+CONFIG_DM_USB=y
+CONFIG_USB_DWC2=y
+CONFIG_USB_STORAGE=y
+CONFIG_DESIGNWARE_WATCHDOG=y
+CONFIG_WDT=y
+CONFIG_CMD_WDT=y
+# CONFIG_SPL_USE_TINY_PRINTF is not set
+CONFIG_PANIC_HANG=y
-- 
2.25.1

